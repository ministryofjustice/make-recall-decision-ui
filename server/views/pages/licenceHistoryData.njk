{% set containerClasses="no-max-width" %}

{% extends "govuk/template.njk" %}
{% from "govuk/components/phase-banner/macro.njk" import govukPhaseBanner %}
{% from "govuk/components/back-link/macro.njk"           import govukBackLink %}
{% from "govuk/components/details/macro.njk"             import govukDetails %}
{% from "govuk/components/table/macro.njk" import govukTable %}
{% from "govuk/components/summary-list/macro.njk" import govukSummaryList %}
{% from "govuk/components/radios/macro.njk" import govukRadios %}
{% from "govuk/components/error-summary/macro.njk"       import govukErrorSummary %}
{% from "govuk/components/input/macro.njk"               import govukInput %}
{%- from "moj/components/sub-navigation/macro.njk" import mojSubNavigation -%}
{%- from "moj/components/search/macro.njk" import mojSearch -%}
{%- from "moj/components/badge/macro.njk" import mojBadge -%}
{%- from "moj/components/filter/macro.njk" import mojFilter -%}
{% from "components/oasys-card/macro.njk"             import oasysCard %}
{% from "components/summary-card/macro.njk"             import appSummaryCard %}
{% from "components/rosh-widget/macro.njk" import roshWidget %}
{% from "components/predictor-indicator/macro.njk" import predictorIndicator %}
{% from "components/predictor-score/macro.njk" import predictorScore %}
{% from "components/predictor-timeline/macro.njk" import predictorTimeline %}
{% from "components/risk-flag-widget/macro.njk" import riskFlagWidget %}
{% from "components/mappa-widget/macro.njk" import mappaWidget %}

{% block head %}
    <!--[if !IE 8]><!-->
    <link href="/assets/stylesheets/application.css?{{ version }}" rel="stylesheet" />
    <!--<![endif]-->

    <!--[if lt IE 9]>
  <link href='/assets/stylesheets/application-ie8.css?{{ version }}' rel='stylesheet'/>
  <script src='/assets/js/html5shiv-3.7.3.min.js'></script>
  <![endif]-->

    <script src="/assets/js/jquery.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"
            integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU="
            crossorigin="anonymous"></script>
    <link href="https://code.jquery.com/ui/1.12.1/themes/ui-lightness/jquery-ui.css" rel="stylesheet" crossorigin>
    <script nonce='{{ cspNonce }}'>
      window.MOJFrontend = window.MOJFrontend || {}</script>
    <script src='/assets/moj/components/sortable-table/sortable-table.js'></script>
    {% block headEnd %}{% endblock %}
{% endblock %}
{% block content %}
    <div class="govuk-!-margin-left-4 govuk-!-margin-right-4">
        <h1 class='govuk-heading-m'>Contact history</h1>

        <div class='govuk-body govuk-!-margin-bottom-4 govuk-!-font-weight-bold'>{{ caseSummaryRaw.contactSummary.length }}
            contacts
        </div>

        <table class="govuk-table" id='table-contact-history'>
            <caption class="govuk-table__caption govuk-visually-hidden">Contact history</caption>
            <thead class="govuk-table__head">
            <tr class="govuk-table__row">
                <th scope="col" class="govuk-table__header" aria-sort="descending">Start date</th>
                <th scope="col" class="govuk-table__header" aria-sort="none">Type</th>
                <th scope="col" class="govuk-table__header" aria-sort="none">Outcome</th>
                <th scope="col" class="govuk-table__header" aria-sort="none">Enforcement</th>
                <th scope="col" class="govuk-table__header" aria-sort="none">System</th>
                <th scope="col" class="govuk-table__header">Notes</th>
            </tr>
            </thead>
            <tbody class="govuk-table__body">
            {% for contact in caseSummaryRaw.contactSummary %}
                <tr class="govuk-table__row" data-qa='row-{{ loop.index }}'>
                    <td class="govuk-table__cell" data-sort-value='{{ contact.contactStartDate }}'><span
                                class='no-wrap-tablet'>{{ formatDateTimeFromIsoString({isoDate: contact.contactStartDate}) }}</span>
                    </td>
                    <td class="govuk-table__cell">{{ contact.descriptionType }}</td>
                    <td class="govuk-table__cell">{{ contact.outcome }}</td>
                    <td class="govuk-table__cell">{{ contact.enforcementAction }}</td>
                    <td class="govuk-table__cell">{{ 'Yes' if contact.systemGenerated else 'No' }}</td>
                    <td class="govuk-table__cell">
                        <pre class='govuk-body'>{{ contact.notes }}</pre>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
        <script nonce='{{ cspNonce }}'>
          new MOJFrontend.SortableTable({
            table: $('#table-contact-history')[0],
          })
        </script>

    </div>

{% endblock %}


{% block bodyEnd %}
    {# Run JavaScript at end of the
  <body>, to avoid blocking the initial render. #}
    <script src="/assets/govuk/all.js"></script>
    <script src="/assets/govukFrontendInit.js"></script>
    <script src="/assets/moj/all.js"></script>
{% endblock %}
