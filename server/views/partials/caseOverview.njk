<h1 class='govuk-heading-m govuk-visually-hidden'>Overview<span
            class='govuk-visually-hidden'> for {{ caseSummary.personalDetailsOverview.name }}</span></h1>
<div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds-from-desktop">
        {% include './notificationBanners/multipleActiveCustodialBanner.njk' %}
        {% set licenceHtml %}
            <div class='flex flex--space-between'>
                <div class='flex__item-half-width'>
                    <h3 class="govuk-caption-m govuk-!-margin-top-0 govuk-!-margin-bottom-2">Last release date</h3>
                    <div class='govuk-heading-m govuk-!-margin-top-0' data-qa='lastReleaseDate'>
                        {{ formatDateTimeFromIsoString({isoDate: caseSummary.releaseSummary.lastRelease.date}) if (not caseSummary.convictions.hasMultipleActiveCustodial) and caseSummary.convictions.activeCustodial.length and caseSummary.releaseSummary.lastRelease.date else 'Not available' }}
                    </div>
                </div>
                <div class='flex__item-half-width'>
                    <h3 class="govuk-caption-m govuk-!-margin-top-0 govuk-!-margin-bottom-2">Licence expiry
                        date</h3>
                    <div class='govuk-heading-m govuk-!-margin-top-0' data-qa='licenceExpiryDate'>
                        {{ formatDateTimeFromIsoString({isoDate: caseSummary.convictions.activeCustodial[0].licenceExpiryDate }) if (not caseSummary.convictions.hasMultipleActiveCustodial) and caseSummary.convictions.activeCustodial[0].licenceExpiryDate else 'Not available' }}</li>
                    </div>
                </div>
            </div>
        {% endset %}
        {{ appSummaryCard({
            titleText: 'Licence',
            classes: 'govuk-!-margin-bottom-6 app-summary-card--large-title',
            html: licenceHtml
        }) }}
        {% set offenceSentenceHtml %}
            {% if not caseSummary.convictions.active.length %}
            <p class='govuk-body'>This person has no active offences or convictions.</p>
            {%  else %}
            {% for conviction in caseSummary.convictions.active %}
                {% set mainOffencesHtml %}
                    {% if conviction.offences.main.length %}
                        <ul class='govuk-list'>
                            {% for offence in conviction.offences.main %}
                                <li>{{ offence }}</li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        Not available
                    {% endif %}
                {% endset %}
                {% set additonalOffencesHtml %}
                    <ul class='govuk-list'>
                        {% for offence in conviction.offences.additional %}
                            <li>{{ offence }}</li>
                        {% endfor %}
                    </ul>
                {% endset %}
                <div {% if loop.index > 1 %} class='govuk-!-margin-top-2 govuk-!-padding-top-2 border-top'{% endif %}>
                    {{ govukSummaryList({
                        classes: 'govuk-summary-list--no-border',
                        attributes: {
                            'data-qa': 'conviction-' + loop.index
                        },
                        rows: [
                            {
                                key: { html: 'Main offence' },
                                value: { html: mainOffencesHtml }
                            },
                            {
                                key: { html: 'Additional offence(s)' },
                                value: { html: additonalOffencesHtml }
                            } if conviction.offences.additional.length else undefined,
                            {
                                key: { html: 'Sentence type' },
                                value: { text: conviction.sentenceDescription + " (" + conviction.sentenceOriginalLength + " " + conviction.sentenceOriginalLengthUnits + ")" if conviction.sentenceDescription else 'Not available' }
                            },
                            {
                                key: { html: 'Sentence expiry date' },
                                value: { text: formatDateTimeFromIsoString({isoDate: conviction.sentenceExpiryDate if conviction.sentenceExpiryDate else 'Not available' }) }
                            } if conviction.isCustodial else undefined
                        ]
                    }) }}
                </div>
            {% endfor %}
            {% endif %}
        {% endset %}
        {{ appSummaryCard({
            titleText: 'Offence and sentence',
            classes: 'govuk-!-margin-bottom-6 app-summary-card--large-title',
            html: offenceSentenceHtml
        }) }}

        {% set offenceDescriptionHtml %}
        {% if caseSummary.risk.assessments.offenceDataFromLatestCompleteAssessment === false %}
            <div class='govuk-!-margin-bottom-4'>
                {% include './notificationBanners/incompleteAssessmentBanner.njk' %}
            </div>
        {% endif %}
        {% if caseSummary.risk.assessments.offenceCodesMatch === false %}
            <div class='govuk-!-margin-bottom-4'>
                {% include './notificationBanners/mainOffenceMismatchBanner.njk' %}
            </div>
        {% endif %}
        <div class="govuk-!-margin-bottom-2 text-secondary">
            OASys 2.1 Offence description
        </div>
        {% if caseSummary.risk.assessments.error %}
            <p class='govuk-body' data-qa='offence-description-error'>This information cannot be retrieved from OASys. Double-check OASys for the latest description of the index offence.</p>
        {% else %}
            <div class="govuk-!-padding-bottom-4 govuk-!-margin-bottom-4 govuk-section-break--visible text-secondary">
                Last updated: {{ formatDateTimeFromIsoString({ isoDate: caseSummary.risk.assessments.lastUpdatedDate, dateOnly: true }) }}
            </div>
            {{ govukSummaryList({
                classes: 'govuk-summary-list--no-border',
                rows: [
                    {
                        key: { html: 'Description' },
                        value: { text: caseSummary.risk.assessments.offenceDescription }
                    }
                ]
            })}}
        {% endif %}
        {% endset %}

        {{ appSummaryCard({
            titleText: 'Offence description',
            classes: 'govuk-!-margin-bottom-6 app-summary-card--large-title',
            attributes: {
                'data-qa': 'offence-description'
            },
            html: offenceDescriptionHtml
        }) }}
    </div>
    <div class="govuk-grid-column-one-third-from-desktop" data-qa='riskFlags'>
        {{ riskFlagWidget(caseSummary.risk.flags) }}
    </div>
</div>