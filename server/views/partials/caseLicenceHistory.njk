<h1 class='govuk-heading-m'>Licence history</h1>

{% set contentHtml %}
    {{ govukSummaryList({
        rows: [
            {
                key: { html: 'Last release date' },
                value: { text: formatDateFromIsoString(caseSummary.releaseSummary.lastRelease.date) }
            },
            {
                key: { html: 'Last recall date' },
                value: { text: formatDateFromIsoString(caseSummary.releaseSummary.lastRecall.date) }
            }
        ]
    }) }}

    <table class="govuk-table" id='table-licence-history'>
        <caption class="govuk-table__caption govuk-visually-hidden">Licence history</caption>
        <thead class="govuk-table__head">
        <tr class="govuk-table__row">
            <th scope="col" class="govuk-table__header" aria-sort="descending">Contact start date</th>
            <th scope="col" class="govuk-table__header" aria-sort="none">Description type</th>
            <th scope="col" class="govuk-table__header" aria-sort="none">Outcome</th>
            <th scope="col" class="govuk-table__header" aria-sort="none">Enforcement action</th>
            <th scope="col" class="govuk-table__header">Notes</th>
        </tr>
        </thead>
        <tbody class="govuk-table__body">
        {% for contact in caseSummary.contactSummary %}
            <tr class="govuk-table__row" data-qa='row-{{ loop.index }}'>
                <td class="govuk-table__cell" data-sort-value='{{ contact.contactStartDate }}'><span
                            class='no-wrap-tablet'>{{ formatDateFromIsoString(contact.contactStartDate) }}</span></td>
                <td class="govuk-table__cell">{{ contact.descriptionType }}</td>
                <td class="govuk-table__cell">{{ contact.outcome }}</td>
                <td class="govuk-table__cell">{{ contact.enforcementAction }}</td>
                <td class="govuk-table__cell">
                    <pre class='govuk-body'>{{ contact.notes }}</pre>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    <script nonce='{{ cspNonce }}'>
      new MOJFrontend.SortableTable({
        table: $('#table-licence-history')[0],
      })
    </script>
{% endset %}
{{ govukDetails({
    summaryHtml: "Show table",
    html: contentHtml,
    open: params.open
}) }}

<div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds-from-desktop">
        {% for contact in caseSummary.contactSummary %}
            {% set titleHtml %}
                <div data-qa='heading'>{{ contact.descriptionType }}</div>
            {% endset %}

            {% set sectionHtml %}
                <pre class='govuk-body' data-qa='notes'>{{ contact.notes }}</pre>
            {% endset %}
            <div data-qa='contact-{{ loop.index0 }}'>
                <div class='govuk-body govuk-!-margin-bottom-3' data-qa='date'>{{ formatDateFromIsoString(contact.contactStartDate) }}</div>
                {{ appSummaryCard({
                    titleHtml: titleHtml,
                    classes: 'govuk-!-margin-bottom-6 app-summary-card--large-title',
                    html: sectionHtml,
                    actionsHtml: mojBadge({
                        text: contact.outcome,
                        attributes: {
                            'data-qa': 'outcome'
                        }
                    }) if contact.outcome else undefined
                }) }}
            </div>

        {% endfor %}
    </div>
</div>